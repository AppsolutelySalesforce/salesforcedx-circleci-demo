machine:
  timezone: America/New_York
  environment:
    DX_CLI_URL: https://developer.salesforce.com/media/salesforce-cli/sfdx-v5.6.22-f9533ba-linux-amd64.tar.xz
    SFDX_DISABLE_ENCRYPTION: true

dependencies:
  override:
    - wget -qO- $DX_CLI_URL | tar xJf -
    - ./heroku/install
    - mkdir tmp && echo $SERVER_KEY >> tmp/server.key
    - sfdx force:auth:jwt:grant --clientid $CONSUMER_KEY --jwtkeyfile tmp/server.key --username $SFDC_USER --setdefaultdevhubusername

test:
  override:
    - sfdx force --help
    # - sfdx force:org:create -s -f config/workspace-scratch-def.json -a ciorg
    # - sfdx force:source:push -u ciorg
    # - sfdx force:apex:test:run -c -r human
    # - sleep 4m
    # - sfdx force:org:delete -u ciorg -p
